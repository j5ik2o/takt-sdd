name: opsx-apply
description: OpenSpec Apply - Implement tasks from a change
piece_config:
  provider_options:
    codex:
      network_access: true
    opencode:
      network_access: true
max_movements: 30
initial_movement: apply

personas:
  opsx-implementer: ../facets/personas/opsx-implementer.md

instructions:
  apply: ../facets/instructions/opsx-apply.md

report_formats:
  opsx-apply-summary: ../facets/output-contracts/opsx-apply-summary.md

movements:
  - name: apply
    edit: true
    persona: opsx-implementer
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Write
      - Edit
      - Bash
      - WebSearch
      - WebFetch
    required_permission_mode: edit
    instruction: apply
    output_contracts:
      report:
        - name: apply-summary.md
          format: opsx-apply-summary
    rules:
      - condition: All tasks completed successfully
        next: COMPLETE
      - condition: Blocked or unable to continue
        next: ABORT
        appendix: |
          Reason:
          - {failure_reason}
