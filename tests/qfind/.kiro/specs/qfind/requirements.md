## 導入

`qfind` は、開発者が大規模なディレクトリツリーから目的のファイルを検索するための Rust 製 CLI ツールである。本要件では、ファイル名の glob 条件とファイル内容の正規表現条件を組み合わせ、再現可能な検索結果を得るための機能要件を定義する。

本要件は、`.gitignore` の尊重、並列ディレクトリ走査、JSON 出力、最大深度制限、ならびに `cargo init` から開始するテスト可能なプロジェクト構成を対象とする。各受け入れ条件は EARS 形式で記述し、正常系・異常系・境界条件を検証可能にする。

## 要件

### 1. ファイル名 glob マッチング
**目的:** CLI 利用者としてファイル名パターンで検索対象を絞り込み、確認対象の件数を減らしたい。

**受け入れ条件:**
- 1.1 ユーザーがファイル名 glob パターンを指定して検索を実行したとき、qfind CLI はファイル名がその glob パターンに一致するパスのみを結果集合に含めなければならない。
- 1.2 ファイル名 glob パターンが指定されていないならば、qfind CLI はファイル名による除外を行ってはならない。
- 1.3 無効な glob パターンが入力された場合、qfind CLI は終了コード 0 以外で終了しなければならない。
- 1.4 ファイル名 glob パターンに一致するパスが 0 件の場合、qfind CLI は空の結果集合を返し、終了コード 0 で終了しなければならない。

**依存要件:** なし。

### 2. 正規表現による内容検索
**目的:** CLI 利用者としてファイル内容に含まれる文字列パターンで検索し、対象箇所を特定したい。

**受け入れ条件:**
- 2.1 ユーザーが内容検索用の正規表現を指定して検索を実行したとき、qfind CLI は内容に 1 回以上一致があるファイルのみを結果集合に含めなければならない。
- 2.2 内容検索用の正規表現が指定されていないならば、qfind CLI はファイル内容による除外を行ってはならない。
- 2.3 無効な正規表現が入力された場合、qfind CLI は終了コード 0 以外で終了しなければならない。
- 2.4 正規表現に一致する内容を持つファイルが 0 件の場合、qfind CLI は空の結果集合を返し、終了コード 0 で終了しなければならない。

**依存要件:** なし。

### 3. .gitignore の尊重
**目的:** CLI 利用者としてバージョン管理対象外のファイルを検索対象から除外し、不要な結果を減らしたい。

**受け入れ条件:**
- 3.1 検索ルート配下に `.gitignore` が存在するならば、qfind CLI はそのルールに一致するパスを探索対象から除外しなければならない。
- 3.2 `.gitignore` で無視対象に設定されたパスに一致するファイルしか存在しない場合、qfind CLI は空の結果集合を返し、終了コード 0 で終了しなければならない。
- 3.3 検索ルート配下に `.gitignore` が存在しない場合、qfind CLI は `.gitignore` による除外を適用してはならない。

**依存要件:** なし。

### 4. 並列ディレクトリ走査
**目的:** CLI 利用者として大規模ディレクトリを検索するときの待ち時間を削減したい。

**受け入れ条件:**
- 4.1 qfind CLI は常に Rayon ベースの並列実行でディレクトリ走査を行わなければならない。
- 4.2 走査対象に複数ディレクトリが含まれるとき、qfind CLI は並列に探索した場合でも結果集合の内容を実行ごとに同一にしなければならない。
- 4.3 走査中に読み取り権限のないディレクトリまたはファイルが検出された場合、qfind CLI は読み取り可能な他のパスの探索を継続しなければならない。

**依存要件:** 1, 2, 3, 6。

### 5. JSON 出力オプション
**目的:** CLI 利用者として検索結果を機械可読形式で受け取り、他ツールに連携したい。

**受け入れ条件:**
- 5.1 JSON 出力オプションが指定されたとき、qfind CLI は標準出力に UTF-8 の JSON 配列を出力しなければならない。
- 5.2 JSON 出力オプションが指定されていないならば、qfind CLI は JSON 以外の通常テキスト形式で結果を出力しなければならない。
- 5.3 JSON 出力オプションが指定され、検索結果が 0 件の場合、qfind CLI は `[]` を出力しなければならない。
- 5.4 JSON 出力オプションが指定され、検索結果が 1 件以上の場合、qfind CLI は各要素に `path` フィールドを含めなければならない。

**依存要件:** 1, 2, 3, 6。

### 6. 最大深度制限オプション
**目的:** CLI 利用者として探索範囲を制限し、不要な深い階層の走査を避けたい。

**受け入れ条件:**
- 6.1 最大深度 `N` が指定されたとき、qfind CLI は検索ルートから深度 `N` 以下のパスのみを探索しなければならない。
- 6.2 最大深度 `0` が指定された場合、qfind CLI は検索ルート直下の項目のみを探索しなければならない。
- 6.3 最大深度に 0 以上の整数以外が指定された場合、qfind CLI は終了コード 0 以外で終了しなければならない。

**依存要件:** なし。

### 7. プロジェクト構築とテスト
**目的:** 開発者として `qfind` を再現可能にビルド・検証できる状態を維持したい。

**受け入れ条件:**
- 7.1 新規ディレクトリからプロジェクトを初期化するとき、qfind プロジェクトは `cargo init` により生成される構成を持たなければならない。
- 7.2 qfind プロジェクトはユニットテストとして、glob マッチング、正規表現内容検索、`.gitignore` 除外、最大深度制限を検証するテストケースを含まなければならない。
- 7.3 qfind プロジェクトは統合テストとして、CLI からの JSON 出力、無効な glob または正規表現入力、最大深度制限を検証するテストケースを含まなければならない。
- 7.4 `cargo test` が実行されたとき、qfind プロジェクトの全テストは成功しなければならない。

**依存要件:** 1, 2, 3, 4, 5, 6。

### 8. 要件間の依存管理
**目的:** 開発者として要件の適用順序を明確にし、設計・実装時の取りこぼしを防ぎたい。

**受け入れ条件:**
- 8.1 要件 4 を適用する場合、qfind CLI は要件 1, 2, 3, 6 で定義された探索条件を同時に満たせる状態でなければならない。
- 8.2 要件 5 を適用する場合、qfind CLI は要件 1, 2, 3, 6 で確定した結果集合を入力として出力形式を決定しなければならない。
- 8.3 要件 7 を適用する場合、qfind プロジェクトのテストは要件 1, 2, 3, 4, 5, 6 を検証対象に含めなければならない。
